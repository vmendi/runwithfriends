<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
        <title>
        </title>
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
        <link rel="stylesheet" href="styles.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>
        <script src="canvas.js"></script>
    </head>
    <body>
        <div id="fb-root"></div>
    
        <!-- Home -->
        <div data-role="page" id="HomePage">
            <div data-role="content">
            <center>
                <img src="LoginFacebook.png" alt="image" onClick="onFBLoginClick();"  /><br/>
                <span id="CurrentCoords"></span><br/>
                <span id="CurrentSpeed"></span>
            </center>
            </div>
        </div>

        <!-- Challenge ReceivedPage -->
        <div id="ChallengeReceivedPage" data-role="page">
        <!--
          <div data-role="navbar" class="nav-bar" data-iconpos="top">
                <ul>
                    <li><a href="#HomePage" class="">Home</a></li>
                    <li><a href="#BonusPage" class="">Bonus</a></li>
                    <li><a href="#RanksPage" class="">Ranks</a></li>
                    <li><a href="#ChallengeReceivedPage" class="ui-btn-active ui-state-persist" data-icon="race-page"></a></li>                    
                </ul>
            </div>
        -->
          <div data-role="content">
            <center>
                <div style="position:relative; width:320px;height:460px;">
                    <div style="margin:-4px;padding:0px;">
                        <img style="width: 320px; height: 80px" src="./images/nav_race.png">
                    </div>
                    <div style="">
                        <img style="width: 320px; height: 381px" src="./images/race_bg.png">
                    </div>
                    <div id="randomFriendPicture" style='position:absolute;top:178px;left:23px;'></div>
                    <div id="randomFriendName" style='position:absolute;top:173px;left:66px;' class="my-big-font"></div>
                    <div onClick="$.mobile.changePage('#ChallengeTimeLine');" style='position:absolute;top:228px;left:116px;width:94px;height:46px;'></div>
                </div>
            </center>
          </div>
        </div>

        <!-- Challenge TimeLine -->
        <div id="ChallengeTimeLine" data-role="page">
          <div data-role="header">
            <h1>Challenging!</h1>
          </div>
          <div data-role="content">
            <center>
                <p>You are challenging your friend!</p>
                <canvas id="myCanvas" width="320" height="380" style="border:1px solid #000000;"> </canvas>
            </center>
          </div>
        </div>

        <script>
            function onFBLoginClick() {
                FB.login(null, {scope: 'email'});
            }

            function onFacebookInitialized() {
                $.mobile.changePage("#ChallengeReceivedPage");
            }

            $(document).ready(function() {
                $(document).bind('pagechange', function(event, data) {
                    var id = data.toPage.attr("id");
                    if (id == "ChallengeReceivedPage") {

                        // Show the user
                        $("#userInfo").html('<img src="https://graph.facebook.com/' + user.id + '/picture">' + user.name);

                        var friend = null;

                        // Pick our favorite judge
                        for(var c=0; c < GlobalFriends.length; c++) {
                            if (GlobalFriends[c].id === "507223094") {
                                friend = GlobalFriends[c];
                                break;
                            }
                        }

                        // Pick a random friend, show him/her
                        if (friend == null)
                            friend = GlobalFriends[Math.round(Math.random()*GlobalFriends.length)-1];

                        //$("#randomFriendInfo").html('<img src="https://graph.facebook.com/' + friend.id + '/picture">' + friend.name);
                        
                        $("#randomFriendPicture").html('<img width="33" height="33" src="https://graph.facebook.com/' +friend.id +'/picture">');
                        $("#randomFriendName").html(friend.name);
                        
                        // Nah, always show our favorite judge
                        $("#randomFriendPicture").html('<img width="33" height="33" src="https://graph.facebook.com/507223094/picture">');
                        $("#randomFriendName").html('Daniel Seeff');
                    }
                    if(data.toPage.attr("id")=="ChallengeTimeLine"){
                        iniciateCanvas();
                    }
                });
            });
        </script>
        <script src="auth.js"></script>
    </body>
</html>