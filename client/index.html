<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
        <title>
        </title>
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
        <link rel="stylesheet" href="my.css" />
        <style>
            /* App custom styles */
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
        </script>
        <script src="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.1/jquery.mobile-1.1.1.min.js">
        </script>
    </head>
    <body>
        <div id="fb-root"></div>
    
        <!-- Home -->
        <div data-role="page" id="HomePage">
            <div data-role="content">
            <center>
                <img src="LoginFacebook.png" alt="image" onClick="onFBLoginClick();"  /><br/>
                <span id="CurrentCoords"></span><br/>
                <span id="CurrentSpeed"></span>
            </center>
            </div>
        </div>

        <!-- Challenge ReceivedPage -->
        <div id="ChallengeReceivedPage" data-role="page">
          <div data-role="header">
            <h1>New Challenge!</h1>
          </div>
          <div data-role="content">
            <center>
                <div id="userInfo"></div><br/>
                <p>You have received a new challenge from</p>
                <div id="randomFriendInfo"></div><br/>
                <a href="#TimelineFake" data-theme="b" class="ui-btn-right" data-transition="flip">Accept Challenge!</a>
            </center>
          </div>
        </div>

        <script>
            function onFBLoginClick() {
                FB.login(null, {scope: 'email'});
            }

            if (navigator.geolocation) {
              navigator.geolocation.watchPosition(
                displayPosition, 
                displayError,
                { enableHighAccuracy: true, timeout: 10 * 1000 * 1000, maximumAge: 0 }
              );
            }
            else {
              alert("Geolocation is not supported by this browser");
            }

            function displayPosition(position) {
              var currentCoordsElement = $("#CurrentCoords");
              var currentSpeedElement = $("#CurrentSpeed");

              if (currentCoordsElement) {
                currentCoordsElement.text("Latitude: " + position.coords.latitude + ", Longitude: " + position.coords.longitude);
              }

              if (currentSpeedElement) {
                currentSpeedElement.text("Speed: " + (position.coords.speed? position.coords.speed : "0"))
              }
            }
            function displayError(error) {
              var errors = { 
                1: 'Permission denied',
                2: 'Position unavailable',
                3: 'Request timeout'
              };
              alert("Error: " + errors[error.code]);
            }

            function onFacebookInitialized() {
                $.mobile.changePage("#ChallengeReceivedPage");
            }

            $(document).ready(function() {
                $(document).bind('pagechange', function(event, data) {
                    var id = data.toPage.attr("id");
                    if (id == "ChallengeReceivedPage") {

                        // Show the user
                        $("#userInfo").html('<img src="https://graph.facebook.com/' + user.id + '/picture">' + user.name);

                        // Pick a random friend, show him/her
                        var randomFriendIndex = Math.round(Math.random()*GlobalFriends.length)-1;
                        var friend = GlobalFriends[randomFriendIndex]
                        $("#randomFriendInfo").html('<img src="https://graph.facebook.com/' + friend.id + '/picture">' + friend.name);
                    }
                });
            });
        </script>
        <script src="auth.js"></script>
    </body>
</html>